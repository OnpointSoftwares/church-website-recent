<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSP Test - Direct Meta Tag</title>
    
    <!-- Direct CSP Meta Tag Test -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://code.jquery.com https://www.googletagmanager.com https://www.google-analytics.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https: blob:; connect-src 'self' https://www.google-analytics.com https://analytics.google.com https://fonts.googleapis.com https://fonts.gstatic.com; object-src 'none'; base-uri 'self';">
    
    <!-- Test Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>CSP Direct Test</h1>
        
        <div class="test-result info">
            <h3>Test Purpose</h3>
            <p>This page tests CSP policy directly with a meta tag, bypassing any server configurations.</p>
        </div>
        
        <div class="test-result" id="bootstrap-test">
            <h3>Bootstrap CSS Test</h3>
            <p id="bootstrap-status">Testing...</p>
        </div>
        
        <div class="test-result" id="jquery-test">
            <h3>jQuery Test</h3>
            <p id="jquery-status">Testing...</p>
        </div>
        
        <div class="test-result" id="font-test">
            <h3>Google Fonts Test</h3>
            <p id="font-status">Testing...</p>
        </div>
        
        <div class="test-result info">
            <h3>Instructions</h3>
            <p>1. Open browser developer tools (F12)</p>
            <p>2. Check the Console tab for any CSP violations</p>
            <p>3. Check the Network tab to see if resources are loading</p>
            <p>4. If you see CSP violations, there's a server-level policy overriding our meta tag</p>
        </div>
    </div>

    <!-- Test jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script>
        // Test Bootstrap CSS
        function testBootstrap() {
            const testDiv = document.createElement('div');
            testDiv.className = 'btn btn-primary';
            testDiv.style.display = 'none';
            document.body.appendChild(testDiv);
            
            const computedStyle = window.getComputedStyle(testDiv);
            const hasBootstrapStyles = computedStyle.backgroundColor !== 'rgba(0, 0, 0, 0)' && 
                                     computedStyle.backgroundColor !== 'transparent';
            
            document.body.removeChild(testDiv);
            
            const statusEl = document.getElementById('bootstrap-status');
            const containerEl = document.getElementById('bootstrap-test');
            
            if (hasBootstrapStyles) {
                statusEl.textContent = '✅ Bootstrap CSS loaded successfully!';
                containerEl.className = 'test-result success';
            } else {
                statusEl.textContent = '❌ Bootstrap CSS failed to load. Check console for CSP errors.';
                containerEl.className = 'test-result error';
            }
        }
        
        // Test jQuery
        function testJQuery() {
            const statusEl = document.getElementById('jquery-status');
            const containerEl = document.getElementById('jquery-test');
            
            if (typeof jQuery !== 'undefined' && typeof $ !== 'undefined') {
                statusEl.textContent = '✅ jQuery loaded successfully! Version: ' + jQuery.fn.jquery;
                containerEl.className = 'test-result success';
            } else {
                statusEl.textContent = '❌ jQuery failed to load. Check console for CSP errors.';
                containerEl.className = 'test-result error';
            }
        }
        
        // Test Google Fonts
        function testGoogleFonts() {
            const link = document.createElement('link');
            link.href = 'https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap';
            link.rel = 'stylesheet';
            
            const statusEl = document.getElementById('font-status');
            const containerEl = document.getElementById('font-test');
            
            link.onload = function() {
                statusEl.textContent = '✅ Google Fonts loaded successfully!';
                containerEl.className = 'test-result success';
            };
            
            link.onerror = function() {
                statusEl.textContent = '❌ Google Fonts failed to load. Check console for CSP errors.';
                containerEl.className = 'test-result error';
            };
            
            document.head.appendChild(link);
            
            // Timeout fallback
            setTimeout(() => {
                if (statusEl.textContent === 'Testing...') {
                    statusEl.textContent = '⚠️ Google Fonts test timed out. May be blocked by CSP.';
                    containerEl.className = 'test-result error';
                }
            }, 5000);
        }
        
        // Run tests when page loads
        window.addEventListener('load', function() {
            setTimeout(testBootstrap, 100);
            setTimeout(testJQuery, 200);
            setTimeout(testGoogleFonts, 300);
        });
        
        // Log current CSP policy
        console.log('=== CSP Test Page ===');
        console.log('This page uses a direct meta tag CSP policy');
        console.log('If you see CSP violations, there is a server-level policy overriding our configuration');
        
        // Check for CSP violations in console
        const originalConsoleError = console.error;
        console.error = function(...args) {
            if (args.some(arg => typeof arg === 'string' && arg.includes('Content Security Policy'))) {
                console.log('🚨 CSP VIOLATION DETECTED:', ...args);
                console.log('This indicates a server-level CSP policy is overriding our meta tag');
            }
            originalConsoleError.apply(console, args);
        };
    </script>
</body>
</html>
